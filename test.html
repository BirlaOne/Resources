<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>SYBAF Cost Accounting Solutions - BirlaOne</title>
  <link rel="icon" type="image/png" href="https://i.ibb.co/N6QNPW56/logo-1-modified.png" />
  
  <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <script>
    (function() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', savedTheme);
    })();
  </script>
  
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    /* --- Modern UI & Security Styles --- */
    :root {
      --primary-accent: #f89b29;
      --primary-gradient: linear-gradient(90deg, #f89b29, #ff5f6d);
      --danger-color: #e53935;
      --font-sans: 'Inter', sans-serif;
      --border-radius: 14px;
      --transition-speed: 0.3s;
    }
    
    html[data-theme="light"] {
      --bg-color: #f7f7f9;
      --card-bg: #ffffff;
      --text-primary: #1c1c1e;
      --text-secondary: #636366;
      --border-color: #e5e5ea;
      --shadow: 0 6px 25px rgba(0, 0, 0, 0.07);
      --header-bg: rgba(255, 255, 255, 0.8);
      --input-bg: #f0f0f0;
    }

    html[data-theme="dark"] {
      --bg-color: #121212;
      --card-bg: #1e1e1e;
      --text-primary: #f2f2f7;
      --text-secondary: #98989f;
      --border-color: #38383a;
      --shadow: 0 6px 25px rgba(0, 0, 0, 0.2);
      --header-bg: rgba(28, 28, 30, 0.75);
      --input-bg: #2c2c2e;
    }
      
    html[data-theme="sepia"] {
        --bg-color: #f4ecd8;
        --card-bg: #fbf5e9;
        --text-primary: #5b4636;
        --text-secondary: #7d6b59;
        --border-color: #dcd0b9;
        --primary-accent: #a98244;
        --shadow: 0 6px 25px rgba(0, 0, 0, 0.1);
        --header-bg: rgba(244, 236, 216, 0.8);
        --input-bg: #e9deca;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    
    body {
      font-family: var(--font-sans);
      background-color: var(--bg-color);
      color: var(--text-primary);
      transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
    }

    .top-bar { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: var(--header-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid var(--border-color); }
    .top-bar .title { font-family: 'Pacifico', cursive; font-size: 26px; font-weight: 400; color: var(--text-primary); }
    .menu-toggle { background: none; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; }
    .menu-icon { color: var(--text-primary); font-size: 24px; }
    .sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 199; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
    .sidebar-overlay.active { opacity: 1; visibility: visible; }
    .sidebar { position: fixed; top: 0; left: 0; width: 280px; height: 100%; background: var(--card-bg); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); box-shadow: 2px 0 20px rgba(0,0,0,0.2); transform: translateX(-100%); transition: transform 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94); z-index: 200; display: flex; flex-direction: column; }
    .sidebar.active { transform: translateX(0); }
    .sidebar-profile-card { display: flex; align-items: center; gap: 15px; padding: 20px; border-bottom: 1px solid var(--border-color); }
    .sidebar-profile-img { width: 60px; height: 60px; border-radius: 50%; border: 2px solid var(--primary-accent); object-fit: cover; flex-shrink: 0; }
    .sidebar-user-info { overflow: hidden; }
    #sidebar-username { font-weight: 600; font-size: 18px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    #sidebar-user-id { font-size: 14px; color: var(--text-secondary); }
    .sidebar nav { flex-grow: 1; padding: 10px 0; }
    .sidebar nav a { display: flex; align-items: center; gap: 15px; color: var(--text-primary); text-decoration: none; padding: 15px 20px; font-weight: 500; font-size: 16px; transition: background-color 0.2s, color 0.2s; border-radius: 0 30px 30px 0; margin-right: 10px; }
    .sidebar nav a:hover, .sidebar nav a.active { background-color: rgba(248, 155, 41, 0.1); color: var(--primary-accent); }
    .nav-icon { width: 24px; height: 24px; stroke-width: 2; }
    .sidebar-footer { padding: 20px; margin-top: auto; border-top: 1px solid var(--border-color); }
    .logout-button { width: 100%; padding: 12px; border: none; border-radius: 8px; background: var(--danger-color); color: white; font-weight: 600; cursor: pointer; transition: background-color 0.2s; }
    .theme-selector select { background-color: var(--input-bg); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 8px; padding: 6px 10px; font-size: 14px; -webkit-appearance: none; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23888' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 8px center; padding-right: 28px; }

    #main-content-wrapper.locked > * { filter: blur(8px); -webkit-filter: blur(8px); pointer-events: none; }
    .lock-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; justify-content: center; align-items: center; z-index: 500; background-color: rgba(0,0,0,0.5); }
    #main-content-wrapper.locked .lock-overlay { display: flex; }
    .lock-overlay-content { background: var(--card-bg); padding: 20px 30px; border-radius: 12px; box-shadow: var(--shadow); font-weight: 600; font-size: 16px; border: 1px solid var(--border-color); }
    .container { padding: 16px; max-width: 900px; margin: 0 auto; }

    /* --- Original Notebook Theme Styles --- */
    :root {
      --nb-bg-color: #fffaf2;
      --nb-line-color: #d0e2ff;
      --nb-text-color: #222;
      --nb-heading-color: #111;
      --nb-table-header-bg: #eef3f9;
      --nb-border-color: #ccc;
      --nb-formula-bg: #f9f9f9;
      --nb-formula-text: #555;
    }
    .notebook {
      font-family: 'Patrick Hand', cursive;
      background-color: var(--nb-bg-color);
      color: var(--nb-text-color);
      font-size: 18px;
      line-height: 34px;
      max-width: 850px;
      margin: auto;
      padding: 40px 20px;
      background-image: repeating-linear-gradient( to bottom, var(--nb-bg-color) 0px, var(--nb-bg-color) 33px, var(--nb-line-color) 34px, var(--nb-bg-color) 35px );
      border: 1px solid var(--nb-border-color);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .notebook h1, .notebook h2 { font-size: 26px; font-weight: bold; color: var(--nb-heading-color); margin: 0 0 10px; line-height: 1.3; text-align: center; }
    .notebook h3 { font-size: 22px; font-weight: bold; color: #333; margin-top: 34px; margin-bottom: 10px; }
    .notebook h4 { font-size: 20px; font-weight: bold; color: #444; margin-top: 20px; margin-bottom: 5px; text-decoration: underline; }
    .notebook p, .notebook ul, .notebook ol, .notebook table { margin: 0 0 20px; padding-left: 10px; }
    .notebook ul, .notebook ol { padding-left: 30px; }
    .notebook table { width: 100%; border-collapse: collapse; background-color: transparent; font-size: 16px; }
    .notebook th, .notebook td { border: 1px solid var(--nb-border-color); padding: 8px 10px; line-height: 1.5; text-align: center; vertical-align: middle; }
    .notebook th { background-color: var(--nb-table-header-bg); color: var(--nb-heading-color); }
    .notebook hr { border: 0; height: 2px; background-color: var(--nb-line-color); margin: 40px 0; }
    .notebook .formula { font-style: italic; color: var(--nb-formula-text); background-color: var(--nb-formula-bg); padding: 5px 10px; border-left: 3px solid var(--nb-line-color); border-radius: 5px; margin: 15px 0; }
    .notebook .module-title { font-size: 32px; text-align: center; margin-top: 40px; margin-bottom: 20px; color: #0056b3; }
  </style>
</head>

<body>

  <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-profile-card">
      <img src="" id="sidebarProfilePic" class="sidebar-profile-img" alt="Profile"/>
      <div class="sidebar-user-info">
        <div id="sidebar-username">Loading...</div>
        <div id="sidebar-user-id">Student ID: ...</div>
      </div>
    </div>
    <nav>
      <a href="https://birlaone.github.io/BirlaOne/index.html"><svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg><span>Home</span></a>
      <a href="#" class="active"><svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg><span>QB (Cost Accounting)</span></a>
      <a href="#"><svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path></svg><span>QB (Mutual Fund)</span></a>
    </nav>
    <div class="sidebar-footer">
      <button class="logout-button" onclick="logout()">Logout</button>
    </div>
  </aside>

  <header class="top-bar">
    <button class="menu-toggle" onclick="toggleSidebar()"><span class="menu-icon">☰</span></button>
    <h1 class="title">Cost Accounting QB</h1>
    <div class="theme-selector">
        <select id="themeSelect" onchange="changeTheme(this.value)" aria-label="Select theme">
          <option value="light">Light</option>
          <option value="dark">Dark</option>
          <option value="sepia">Sepia</option>
        </select>
    </div>
  </header>

  <main class="container" id="main-content-wrapper">
    <div class="lock-overlay">
        <div class="lock-overlay-content">🔒 Verifying Access...</div>
    </div>
  
    <div class="notebook">
      <h1>SYBAF Cost Accounting</h1>
      <h2>Complete Question Bank Solutions ✍️</h2>
  
      <h2 class="module-title">Module 1: ABC Costing</h2>
      <hr>
      <h3>Q.1) A company produces two products, A and B...</h3>
        <h4>Solution:</h4>
        <h4>a) Traditional Approach (based on Direct Labour Hours)</h4>
        <p><b>Step 1: Calculate Total Direct Labour Hours</b></p>
        <ul>
            <li>Product A: 500 units × 1 hour/unit = 500 hours</li>
            <li>Product B: 1,250 units × 2 hours/unit = 2,500 hours</li>
            <li><b>Total Hours:</b> 500 + 2,500 = 3,000 hours</li>
        </ul>
        <p><b>Step 2: Calculate Traditional Overhead Rate</b></p>
        <p class="formula">Overhead Rate = \( \frac{\text{Total Overhead Cost}}{\text{Total Direct Labour Hours}} \)</p>
        <p>Rate = \( \frac{261780}{3000} \) = <b>₹87.26 per hour</b></p>
        <p><b>Step 3: Allocate Overhead to Each Product</b></p>
        <ul>
            <li><b>Product A:</b> 1 hour/unit × ₹87.26/hour = <b>₹87.26 per unit</b></li>
            <li><b>Product B:</b> 2 hours/unit × ₹87.26/hour = <b>₹174.52 per unit</b></li>
        </ul>
        <h4>b) Activity-Based Costing (ABC) Approach</h4>
        <p><b>Step 1: Calculate Activity Rates for each Cost Pool</b></p>
        <p class="formula">Activity Rate = \( \frac{\text{Estimated Cost}}{\text{Estimated Activity}} \)</p>
        <ul>
            <li><b>Machine Setups:</b> \( \frac{27140}{20 + 26} \) = \( \frac{27140}{46} \) = <b>₹590 per setup</b></li>
            <li><b>Maintenance:</b> \( \frac{183040}{1620 + 2540} \) = \( \frac{183040}{4160} \) = <b>₹44 per sq. ft.</b></li>
            <li><b>Inspections:</b> \( \frac{51600}{56 + 288} \) = \( \frac{51600}{344} \) = <b>₹150 per inspection</b></li>
        </ul>
        <p><b>Step 2: Allocate Overhead Costs to Products</b></p>
        <table>
            <thead>
                <tr><th>Activity</th><th>Product A Cost (₹)</th><th>Product B Cost (₹)</th></tr>
            </thead>
            <tbody>
                <tr><td>Setups</td><td>20 setups × ₹590 = 11,800</td><td>26 setups × ₹590 = 15,340</td></tr>
                <tr><td>Maintenance</td><td>1,620 sq.ft. × ₹44 = 71,280</td><td>2,540 sq.ft. × ₹44 = 1,11,760</td></tr>
                <tr><td>Inspections</td><td>56 insp. × ₹150 = 8,400</td><td>288 insp. × ₹150 = 43,200</td></tr>
                <tr><td><b>Total Overhead</b></td><td><b>₹91,480</b></td><td><b>₹1,70,300</b></td></tr>
            </tbody>
        </table>
        <p><b>Step 3: Calculate Overhead per Unit</b></p>
        <ul>
            <li><b>Product A:</b> \( \frac{91480}{500} \) = <b>₹182.96 per unit</b></li>
            <li><b>Product B:</b> \( \frac{170300}{1250} \) = <b>₹136.24 per unit</b></li>
        </ul>
        <hr>
        </div>
  </main>

<script>
    // --- Supabase and Security Logic ---
    const SUPABASE_URL = 'https://eikriuddsuguybvvyzjl.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVpa3JpdWRkc3VndXlidnZ5empsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgxMjIxNTAsImV4cCI6MjA3MzY5ODE1MH0.HNh2gGO8nWzAjxh5Oa3cs_8WKaq9mq9TyLCvPOkcr2c';
    const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    // UI & UTILITY FUNCTIONS
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('active');
      document.getElementById('sidebarOverlay').classList.toggle('active');
    }
    
    function changeTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
    }

    async function logout() {
      await client.auth.signOut();
      window.location.href = "https://birlaone.github.io/BirlaOne/login.html";
    }

    // SECURITY & PERMISSION FUNCTIONS
    function lockContentSection(message = "🔒 Unauthorized Access") {
        const contentWrapper = document.getElementById('main-content-wrapper');
        contentWrapper.classList.add('locked');
        const overlayText = contentWrapper.querySelector('.lock-overlay-content');
        if (overlayText) {
            overlayText.innerHTML = message;
        }
    }

    function unlockContentSection() {
        const contentWrapper = document.getElementById('main-content-wrapper');
        contentWrapper.classList.remove('locked');
    }

    // DATA FETCHING & RENDERING
    async function fetchAndSetCurrentUser(session) {
      const { data, error } = await client.from('users').select('id, img, name').eq('auth_id', session.user.id).single();
      
      if (error || !data) {
        console.error('Error fetching user profile:', error);
        return null;
      }
      
      const picUrl = data.img || 'https://t4.ftcdn.net/jpg/05/89/93/27/360_F_589932782_vQAEAZhHnq1QCGu5ikwrYaQD0Mmurm0N.jpg';
      document.getElementById('sidebarProfilePic').src = picUrl;
      document.getElementById('sidebar-username').innerText = data.name || 'Student';
      document.getElementById('sidebar-user-id').innerText = `Student ID: ${data.id || 'N/A'}`;
      
      return data;
    }
    
    // APP INITIALIZATION
    async function initializeApp(session) {
        const currentUser = await fetchAndSetCurrentUser(session);
        if (!currentUser) {
          alert("Could not load your profile. Please log in again.");
          lockContentSection("🔒 Profile Error. Please re-login.");
          setTimeout(logout, 2000);
          return;
        }
        // If user is valid, unlock the content
        unlockContentSection();
    }

    document.addEventListener("DOMContentLoaded", async () => {
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        document.getElementById('themeSelect').value = savedTheme;
        
        // Lock content by default while checking auth
        lockContentSection();

        const { data: { session } } = await client.auth.getSession();

        if (session && session.user) {
            initializeApp(session);
        } else {
            lockContentSection("🔒 Redirecting to login...");
            setTimeout(() => {
                window.location.href = "https://birlaone.github.io/BirlaOne/login.html";
            }, 1500);
        }

        client.auth.onAuthStateChange((_event, session) => {
            if (!session) {
                lockContentSection("🔒 Session expired. Redirecting...");
                setTimeout(() => {
                    window.location.href = "https://birlaone.github.io/BirlaOne/login.html";
                }, 1500);
            }
        });
    });
</script>
</body>
</html>
